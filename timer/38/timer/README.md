# 내일 타이머 (Tomorrow Timer)

**내일 타이머**는 ‘오늘/내일(다음날)까지 이어질 수 있는 타이머’와 **스톱워치**를 함께 제공하는 안드로이드 앱입니다.

- 타이머는 **예상 종료 시각(예: 내일 1월 4일 오후 2:40)** 을 화면/알림에서 함께 보여줘, “언제 울리는지”를 즉시 파악할 수 있습니다.
- 알림바(진행중 알림)에서 **일시정지/재개/중지** 등 컨트롤을 제공하며, 알림을 탭하면 **해당 화면(타이머/스톱워치)으로 바로 진입**합니다.

패키지: `com.krdonon.timer`

---

## 1) 주요 기능

### 타이머
- 빠른 프리셋(예: **10분 / 15분 / 30분**) 및 숫자패드 입력
- **예상 종료 시각 표시**(오늘/내일, 월/일, 오전/오후 포함)
- **천분의 1초(밀리초) 표기** 포함: `HH:MM:SS.mmm`
- 진행중 알림(Compact/Expanded)에서 남은 시간 및 종료 예정 시각 표시
- (선택) **보조 타이머(Extra Timer)** 를 함께 표시/관리

### 스톱워치
- 시작/정지/초기화
- 진행중 알림에서 컨트롤 제공
- 알림을 탭하면 스톱워치 화면으로 바로 진입

### 알림 / 알람
- 앱이 백그라운드에 있어도 안정적으로 동작하도록 **Foreground Service** 기반
- 타이머 종료 시 알람 화면(알람 사운드/진동 등)


### 알람(시계 알람) + 그룹
- 알람 생성/편집(시간/요일/이름), 목록 표시 및 개별 ON/OFF
- **그룹(라벨) 단위 관리**: 그룹별 묶음 표시, 그룹별 일괄 ON/OFF
- **선택 모드 관리**: 다중 선택 후 삭제/그룹 이동
- 알람 편집 화면의 **매주** 버튼으로 요일 전체 선택/해제
- 알람 편집 화면 하단 **소리 변경**에서 사용자의 **MP3 파일을 선택/등록**해 알람 소리를 커스터마이징
- 선택한 파일을 찾을 수 없거나(삭제/권한 해제 등) 재생이 실패하면 **기본 내장 사운드(`res/raw/alarm_sound.mp3`)로 자동 복귀**
- (예시 제공) Android 10+에서 `assets/sample_alarm.mp3`를 **Downloads에 1회 설치**해 선택 가능한 “예시 파일”을 제공합니다  
  - 배포용으로는 `sample_alarm.mp3`만 교체하면 동일 로직으로 원하는 기본 MP3를 탑재할 수 있습니다

---

## 2) 사용 방법

### 타이머 설정
1. 하단 탭에서 **타이머** 선택
2. 프리셋(10분/15분/30분) 또는 숫자패드로 시간 입력
3. **시작**을 누르면 타이머가 동작하며, 화면에 **알림 울릴 시간(예상 종료 시각)** 이 표시됩니다.

### 알림바에서 조작
- 알림(진행중 알림)에서 **일시정지/재개/중지** 버튼으로 즉시 제어 가능
- 알림을 탭하면 앱이 열리며, **해당 알림의 화면(타이머/스톱워치)** 로 진입합니다.

---


### 알람(시계 알람) 사용
1. 하단 탭에서 **알람** 선택
2. 우측 하단 **+** 버튼으로 새 알람을 추가합니다.
3. 알람 시간/요일/알람 이름을 설정한 뒤 **저장**을 누릅니다.
4. 알람 목록에서 스위치로 개별 알람을 **ON/OFF** 할 수 있습니다.
5. (선택) 알람 소리를 바꾸려면 알람 편집 화면 하단의 **소리 변경** 오른쪽 **폴더 아이콘**을 눌러 Downloads 등에서 MP3를 선택합니다.
   - 선택이 완료되면 해당 MP3가 알람 재생에 사용됩니다.
   - 파일이 없어지면(삭제 등) 다음 울림부터 자동으로 기본 내장 사운드로 돌아갑니다.

(편의 기능) 알람 편집 화면 상단의 **달력** 버튼을 누르면 **미니 달력 팝업**이 열려 날짜/월을 빠르게 확인할 수 있습니다.


### 알람 그룹(라벨)로 분류/통합 관리
- 알람 목록은 **그룹 헤더** 기준으로 묶여 표시됩니다.
- 그룹 헤더의 스위치로 해당 그룹의 알람을 **일괄 ON/OFF** 할 수 있습니다.
- 알람을 길게 눌러 **선택 모드**로 진입한 뒤, 상단 메뉴의 **그룹 이동**으로 선택된 알람을 다른 그룹으로 이동할 수 있습니다.
- 그룹 관리(추가/이름 변경/삭제)는 알람 화면의 **그룹 관리 버튼**에서 수행합니다.

### 미니 달력(편의 기능)
- 알람 편집 화면 상단의 **달력** 버튼을 누르면 미니 달력 팝업이 열립니다.
- 팝업에서 **월 이동(스와이프/버튼)** 및 **오늘로 이동**이 가능합니다.
- 달력은 “날짜 확인”을 위한 보조 UI이며, 알람의 요일/반복 설정은 기존 요일 버튼에서 합니다.

### 요일 ‘매주’ 버튼(편의 기능)
- 알람 편집 화면에서 **매주**를 누르면 일~토 요일이 **전체 선택**됩니다.
- 다시 누르면 요일이 **전체 해제**됩니다.
## 3) 프로젝트 구조

> (최신 기준) 주요 파일/레이아웃만 요약합니다.

### Kotlin (핵심)
- `MainActivity.kt`
  - 하단 탭(스톱워치/타이머) 네비게이션
  - **마지막 선택 탭 저장/복원**
  - 알림 탭 진입 시, 요청 탭을 즉시 로드
- `ClockService.kt`
  - 타이머/스톱워치/보조 타이머 상태 관리
  - 진행중 알림(Compact/Expanded) 업데이트
  - PendingIntent / requestCode 충돌 방지 및 상태 동기화
- `TimerFragment.kt`, `TimerViewModel.kt`
  - 타이머 UI/상태, 종료 예정 시각 텍스트 갱신
- `StopwatchFragment.kt`, `StopwatchViewModel.kt`
  - 스톱워치 UI/상태
- `NumberPadFragment.kt`
  - 숫자 입력 UI(시간/분/초/천분)
- `alarm/AlarmReceiver.kt`, `alarm/AlarmService.kt`, `alarm/AlarmActivity.kt`
  - 타이머 종료 시 알람 표시/재생(환경에 따라 Fullscreen Intent 사용)


- `alarm/AlarmSoundPrefs.kt`
  - 사용자 알람 사운드(문서 URI) 저장/검증(SharedPreferences) 및 접근 불가 시 기본 사운드로 폴백
- `alarmclock/SampleSoundInstaller.kt`
  - (Android 10+) 예시 MP3(`assets/sample_alarm.mp3`)를 Downloads에 1회 설치(테스트/가이드 목적)
- `alarmclock/MiniCalendarDialogFragment.kt`
  - 알람 편집 화면에서 띄우는 미니 달력 팝업(UI/제스처 포함)

- `alarmclock/AlarmListFragment.kt`, `alarmclock/AlarmEditActivity.kt`
  - 알람(시계 알람) 목록/추가/편집 UI
- `alarmclock/AlarmGroupedAdapter.kt`
  - 그룹 헤더 + 알람 아이템(2 타입) RecyclerView 어댑터
- `alarmclock/GroupItem.kt`, `alarmclock/GroupStore.kt`
  - 그룹(라벨) 모델 및 로컬 저장/로드(SharedPreferences 기반)
### Layout (res/layout)
- `activity_main.xml` : 메인 화면/하단 탭
- `fragment_timer.xml` : 타이머 화면
- `fragment_stopwatch.xml` : 스톱워치 화면
- `fragment_number_pad.xml` / `number_pad.xml` : 숫자패드
- `notification_timer_compact.xml` : 알림(접힘)
- `notification_timer_expanded.xml` : 알림(펼침)
- `activity_alarm.xml` : 알람 화면


- `dialog_mini_calendar.xml` / `item_mini_calendar_day.xml` : 알람 편집 화면의 미니 달력 팝업

- `fragment_alarm_list.xml` : 알람 목록(+ 그룹 헤더 표시/그룹 관리 버튼 포함)
- `activity_alarm_edit.xml` : 알람 추가/편집 화면(요일 ‘매주’ 버튼, 달력 버튼, 소리 변경 행 포함)
- `item_alarm.xml` : 알람 아이템(시간/요일/스위치/선택 체크박스)
- `item_group_header.xml` : 그룹 헤더(그룹명/그룹 스위치)
- `menu_alarm_selection.xml` : 선택 모드 메뉴(전체 선택/삭제/그룹 이동)
---

## 4) 권한 및 시스템 설정(Google Play 설명용)

아래 권한/설정은 **앱 기능 제공을 위해 필요하거나(필수)**, **정확도/안정성 향상을 위해 권장(선택)** 됩니다.

### 필수(또는 사실상 필수)
- `POST_NOTIFICATIONS` (Android 13+)
  - 진행중 타이머/스톱워치 알림 및 제어 버튼 표시
- `FOREGROUND_SERVICE` (+ Android 14+에서 세분화 권한)
  - 앱이 백그라운드에서도 타이머/스톱워치를 안정적으로 실행

### 기기/버전에 따라 필요(기능상 중요)
- `SCHEDULE_EXACT_ALARM` / `USE_EXACT_ALARM` (Android 12+)
  - 타이머 종료 시각에 맞춰 **정확한 알람**을 울리기 위해 사용
  - 일부 기기에서는 설정 화면에서 “정확한 알람 허용”을 켜야 합니다.

### 권장(배터리 최적화 예외)
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` (선택)
  - 제조사 절전 정책이 강한 기기에서 타이머가 지연되는 현상을 줄이기 위해 안내
  - 사용자가 원치 않으면 허용하지 않아도 앱은 동작하지만, 장시간 타이머에서는 정확도가 떨어질 수 있습니다.

### 일반
- `WAKE_LOCK` (필요 시)
  - 알람 울림/화면 표시 등에서 안정성 향상
- `VIBRATE` (필요 시)
- (저장소 권한 관련)
  - 알람 사운드 선택은 **시스템 파일 선택기(ACTION_OPEN_DOCUMENT)** 기반이며, 일반적으로 `READ_MEDIA_AUDIO` 같은 추가 저장소 권한을 요구하지 않습니다(선택한 URI 권한을 앱에 부여).
  - 예시 MP3를 Downloads에 설치하는 기능은 Android 10+에서 MediaStore를 사용해 1회 복사합니다(기기/OS 정책에 따라 동작 방식은 달라질 수 있습니다).
  - 알람 진동

> 실제 Manifest 기준으로 권한 사용 여부는 프로젝트 설정/버전에 따라 달라질 수 있습니다. 배포 전 `AndroidManifest.xml`를 최종 확인하세요.

---

## 5) 빌드 / 실행

### 요구사항
- Android Studio 최신 버전 권장
- **minSdk 26**, **targetSdk 36**
- Kotlin/JVM Target: 11

### 로컬 빌드
```bash
# Debug APK
./gradlew :app:assembleDebug

# Release APK (Proguard/R8 minify)
./gradlew :app:assembleRelease
```

### 설치
- Android Studio에서 Run
- 또는 `adb install`로 APK 설치

---

## 6) 운영 팁 / 트러블슈팅

### (1) 알림을 탭하면 앱이 순간 ‘반짝’이는 현상
일부 단말에서 **SystemUI(알림 패널 닫힘 애니메이션)과 앱의 알림 갱신**이 경합하면,
알림 탭 직후 화면이 잠깐 깜빡이거나(밝기/레이아웃 변화처럼) 보일 수 있습니다.

현재 구현에서는 이를 줄이기 위해 알림으로 진입한 직후 **짧은 시간 알림 업데이트를 일시 중단**하는 로직을 포함합니다.
(예: `ClockService.ACTION_SUSPEND_NOTIFY_UPDATES`).

대부분의 경우 **치명적인 오류가 아니며**, 기능/안정성에 큰 문제가 없으면 그대로 사용해도 무방합니다.

### (2) 정확한 알람이 늦게 울리는 경우
- Android 12+에서 “정확한 알람(Exact alarm)” 허용 여부 확인
- 배터리 최적화 예외(선택) 적용 권장

---

## 7) 개인정보 / 데이터 처리
- 본 프로젝트에는 네트워크 통신 권한(`INTERNET`)이 포함되어 있지 않아, **인터넷 없이 오프라인으로 동작**하도록 설계되어 있습니다.
- 사용자 계정/로그인 기능, 외부 서버 전송 로직이 포함되어 있지 않습니다.

(배포 전 최종 Manifest/의존성/분석 SDK 포함 여부는 반드시 다시 확인하세요.)

---

## 8) Google Play 스토어 설명(초안)

### 앱 소개(짧은 설명)
내일(다음날)까지 이어지는 타이머와 스톱워치를 한 곳에서. 남은 시간뿐 아니라 **언제 울리는지(종료 시각)** 까지 알림과 화면에서 바로 확인하세요.

### 앱 소개(자세한 설명)
내일 타이머는 장시간 타이머(오늘→내일까지)에서도 사용자가 헷갈리지 않도록,
**남은 시간 + 종료 예정 시각(오늘/내일, 오전/오후, 월/일)** 을 함께 표시하는 타이머 앱입니다.

- 빠른 프리셋(10분/15분/30분)과 숫자패드 입력
- 진행중 알림에서 일시정지/재개/중지
- 알림을 탭하면 해당 화면(타이머/스톱워치)으로 바로 열림
- 스톱워치 기능 포함

### 권한 안내(스토어 표기용)
- 알림 권한: 진행중 알림 및 제어 버튼 제공
- 정확한 알람 권한(기기/OS에 따라): 종료 시각에 맞춰 정확히 울리기 위해 필요
- 배터리 최적화 예외(선택): 일부 기기에서 장시간 타이머 정확도 향상을 위해 권장

---

## 9) 라이선스
- 사내/개인 프로젝트 정책에 맞춰 추가하세요.

