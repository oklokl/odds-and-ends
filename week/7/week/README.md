# AM PM 요일 위젯 앱 (Week)

## 📱 앱 설명
홈 화면에 **아이콘 크기(1x1)** 로 배치할 수 있는 **시간/날짜/요일 위젯**입니다.

이 프로젝트는 런처(홈 화면) 환경에 따라 위젯의 자동 갱신이 간헐적으로 누락될 수 있는 문제를 완화하기 위해,
**위젯 탭 → 앱 진입 시 “수동 동기화(강제 갱신)”** 기능을 포함합니다.

---

## ✨ 주요 기능
- **작은 크기**: 1x1 셀 크기 (약 74x74dp 수준)
- **표시 내용**
  - 상단: AM/PM + 시간 (예: AM 8:10)
  - 하단: 날짜 + 요일 (예: 01.02 금)
- **배경색**: #cfffe5 (연한 민트색)
- **자동 갱신**
  - 시스템 시간/타임존/날짜 변경 브로드캐스트를 감지해 위젯을 갱신
  - 시간 표시는 `TextClock`을 사용(런처가 갱신을 놓치는 경우가 있어 아래 수동 동기화로 보강)
- **수동 동기화(중요)**
  - 위젯을 탭하면 앱(MainActivity)으로 들어가며, **진입과 동시에 위젯을 강제로 재적용/갱신**하여
    간헐적인 갱신 누락을 복구합니다.
- **배터리 최적화 제외 유도**
  - 위젯 갱신 누락을 줄이기 위해, 앱에서 **배터리 최적화 제외(무시)** 설정을 권장합니다.
  - 기기/OS에 따라 시스템 팝업 문구가 “백그라운드 실행 허용”처럼 보일 수 있으나,
    이는 **배터리 최적화 제외 승인 절차**입니다.

---

## 📂 프로젝트 구조

```
app/
├── src/main/
│   ├── java/com/krdondon/week/
│   │   ├── MainActivity.kt              # 메인 액티비티(수동 동기화 + 배터리 제외 유도)
│   │   ├── TimeWidgetProvider.kt        # 위젯 프로바이더(AppWidgetProvider)
│   │   └── ui/theme/
│   │       └── Theme.kt                 # 테마 설정
│   ├── res/
│   │   ├── layout/
│   │   │   └── widget_layout.xml        # 위젯 레이아웃(RemoteViews)
│   │   ├── xml/
│   │   │   └── widget_info.xml          # 위젯 정보(AppWidgetProviderInfo)
│   │   └── values/
│   │       └── strings.xml              # 문자열 리소스
│   └── AndroidManifest.xml              # 앱/리시버/권한 설정
└── build.gradle.kts                      # 빌드 설정
```

---

## 🔧 설치 방법

### 1) Android Studio에서 프로젝트 열기
- Android Studio 실행
- **Open an Existing Project** 선택
- 프로젝트 폴더 선택

### 2) 빌드 및 실행
- 메뉴: **Build → Make Project**
- 에뮬레이터/실기기 연결
- **Run** 클릭

---

## 🧩 위젯 추가 방법
1. 앱 실행
2. (권장) **배터리 최적화 제외 설정** 진행
  - 앱 안내 팝업에서 “설정하기”
  - 시스템 팝업에서 “허용”을 누르면 제외 설정이 적용됩니다.
  - 메인 화면의 상태 표시가 **“설정됨”** 으로 바뀌면 성공입니다.
3. 홈 화면 빈 공간 길게 누르기
4. “위젯” 선택
5. “AM PM 요일” 위젯을 홈 화면에 추가

---

## 🔋 배터리 최적화 제외(권장)

### 왜 필요한가요?
일부 기기/런처는 절전 정책 때문에 위젯 갱신이 간헐적으로 멈출 수 있습니다.
배터리 최적화 제외를 설정하면 이런 현상을 **완화**할 가능성이 있습니다.

### 앱에서 확인 가능한 상태
- 메인 화면에 **“배터리 최적화 제외 상태: 설정됨/미설정”** 으로 표시됩니다.
- 이 상태는 `PowerManager.isIgnoringBatteryOptimizations(packageName)` 값을 기반으로 합니다.

---

## 📱 필요한 권한
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`
  - 배터리 최적화 제외(무시) 설정 요청을 위해 사용

> 참고: 이 앱은 별도의 **Foreground Service**를 사용하지 않습니다(서비스 기반 1분 갱신 구조가 아님).

---

## 🔄 갱신 동작 요약
- **자동 갱신**: 시스템 시간/날짜/타임존 변경 이벤트에 반응하여 위젯 갱신
- **수동 갱신(복구용)**: 위젯 탭 → 앱 진입 시 **즉시 위젯 강제 갱신**

---

## 🧯 문제 해결(트러블슈팅)
- 위젯 시간이 멈춘 것처럼 보일 때:
  1) **위젯을 탭**하여 앱으로 들어갑니다. (진입과 동시에 수동 동기화가 수행됩니다.)
  2) 그래도 반복되면 배터리 최적화 제외가 “설정됨”인지 확인하세요.
- 삼성/샤오미/화웨이 등 일부 기기는 “자동 시작”, “백그라운드 제한 해제” 등 제조사 설정이 추가로 필요할 수 있습니다.

---

## 🛠️ 기술 스택
- Kotlin
- Jetpack Compose
- Android App Widget(RemoteViews)
